# Base config: Production-ready with GHCR image
# Run with: docker compose up -d

services:
  app:
    image: ghcr.io/bkaewell/cloudflare-verified-ddns:latest
    container_name: cloudflare-verified-ddns
    restart: unless-stopped
    init: true

    environment:
      TZ: America/New_York
      CYCLE_INTERVAL_S: 60
      LOG_LEVEL: INFO
      ALLOW_PHYSICAL_RECOVERY: "false"
      ROUTER_IP: "192.168.0.1"
      PLUG_IP: "192.168.0.150"    
      CLOUDFLARE_API_TOKEN: ${CLOUDFLARE_API_TOKEN:?required}
      CLOUDFLARE_ZONE_ID: ${CLOUDFLARE_ZONE_ID:?required}
      CLOUDFLARE_DNS_NAME: ${CLOUDFLARE_DNS_NAME:?required}
      CLOUDFLARE_DNS_RECORD_ID: ${CLOUDFLARE_DNS_RECORD_ID:?required}

    read_only: true
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=16m
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    pids_limit: 128

    volumes:
      - cache:/app/cache

    logging:
      driver: json-file
      options:
        max-size: "20m"
        max-file: "15"

volumes:
  cache:

